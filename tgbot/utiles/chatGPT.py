import openai

from config import config


openai.api_key = config.OPENAI_API_KEY.get_secret_value()


async def create_psychological_portrait_week(smilesWeek: str) -> str:
    """
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—Ç—Ä–µ—Ç –∑–∞ –Ω–µ–¥–µ–ª—é.

    –í messages –º—ã –º–æ–∂–µ–º —Å–æ—Å—Ç–∞–≤–∏—Ç—å –¥–∏–∞–ª–æ–≥ –∏ —É–∫–∞–∑–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ –æ–Ω –±—É–¥–µ—Ç –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è
    –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —Å–≤–æ–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤. –û—Ç–≤–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ json —Ñ–æ—Ä–º–∞—Ç–µ, –æ—Ç–∫—É–¥–∞ –¥–∞–ª–µ–µ –º—ã –≤—ã—Ç–∞—Å–∫–∏–≤–∞–µ–º –æ—Ç–≤–µ—Ç.

    :return: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è chatGPT.
    """
    # smilesStr = '\n'.join('{}: {}'.format(key, val) for key, val in smilesDict.items())  # –°–ª–æ–≤–∞—Ä—å –≤ —Å—Ç—Ä–æ–∫—É

    chat_completion_resp = await openai.ChatCompletion.acreate(
                model="gpt-3.5-turbo",
                messages=[
                {"role": "system", "content": '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Ç–µ—á–µ–Ω–∏–∏ –Ω–µ–¥–µ–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–ª —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç—É —Å–º–∞–π–ª–∏–∫–∏, '
                                              '–∫–æ—Ç–æ—Ä—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑–æ–≤–∞–ª–∏ –µ–≥–æ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –º–æ–º–µ–Ω—Ç '
                                              '–æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–º–∞–π–ª–∏–∫–∞. –¢—ã –ø–æ–ª—É—á–∞–µ—à—å —ç—Ç–∏ —Å–º–∞–π–ª–∏–∫–∏ –≤ —Å–ª–µ–¥—É—é—â–µ–º –≤–∏–¥–µ: '
                                              '"(–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–æ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π –¥–∞—Ç—ã): (–Ω–∞–±–æ—Ä —Å–º–∞–π–ª–∏–∫–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)" –∏ –∑–∞—Ç–µ–º '
                                              '–í –∫–∞—á–µ—Å—Ç–≤–µ –≤—ã–≤–æ–¥–∞ —Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—à—å –µ–º—É'
                                              '—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∫–∞–∫ —É–ª—É—á—à–∏—Ç—å —Å–≤–æ–µ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ, –æ—á–µ–Ω—å —ë–º–∫–æ –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω–æ '
                                              '–°–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—à—å —Å–æ —Å–ª–æ–≤: "–ü—Ä–∏–≤–µ—Ç! –Ø –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª –≤—Å–µ —Å–º–∞–π–ª–∏–∫–∏, '
                                              '–∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è–ª –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π". '
                                              '–û–±—â–∞–π—Å—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∫–∞–∫ —Å –¥—Ä—É–≥–æ–º. –¢–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±—É–∫–≤–∞–ª—å–Ω–æ '
                                              '–Ω–µ –±–æ–ª—å—à–µ 7 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π. –¢–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—á–µ–Ω—å —ë–º–∫–∏–º!'
                },  # –ó–∞–¥–∞–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–º–æ—â–Ω–∏–∫—É
                {"role": "user", "content": f"–î–∞–π –º–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —ç—Ç–∏–º –¥–∞–Ω–Ω—ã–º. \n{smilesWeek}"}  # –ó–∞–¥–∞–µ–º –≤–æ–ø—Ä–æ—Å –±–æ—Ç—É
                ],
                max_tokens=700
    )

    return chat_completion_resp.choices[0].message.content


async def create_psychological_portrait_day(smilesDay: str) -> str:
    """
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∑–∞ –¥–µ–Ω—å.

    :param smilesDay: –°–º–∞–π–ª–∏–∫–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–∞ –¥–µ–Ω—å –≤ —Å—Ç—Ä–æ–∫–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.
    :return: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è chatGPT.
    """

    chat_completion_resp = await openai.ChatCompletion.acreate(
        model="gpt-3.5-turbo",
        messages=[
            {"role": "system", "content": '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Ç–µ—á–µ–Ω–∏–∏ –¥–Ω—è –æ—Ç–ø—Ä–∞–≤–ª—è–ª —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç—É —Å–º–∞–π–ª–∏–∫–∏, '
                                          '–∫–æ—Ç–æ—Ä—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑–æ–≤–∞–ª–∏ –µ–≥–æ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –º–æ–º–µ–Ω—Ç '
                                          '–æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–º–∞–π–ª–∏–∫–∞. –¢—ã –ø–æ–ª—É—á–∞–µ—à—å —ç—Ç–∏ —Å–º–∞–π–ª–∏–∫–∏  '
                                          '–æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –∏ –∑–∞—Ç–µ–º '
                                          '—Å–æ—Å—Ç–∞–≤–ª—è–µ—à—å –¥–æ–≤–æ–ª—å–Ω–æ —ë–º–∫–æ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—Ç—Ä–µ—Ç '
                                          '–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –µ–≥–æ —Å–º–∞–π–ª–∏–∫–∞–º –∑–∞ –¥–µ–Ω—å. '
                                          '–í –∫–∞—á–µ—Å—Ç–≤–µ –≤—ã–≤–æ–¥–∞ —Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—à—å –µ–º—É'
                                          '—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∫–∞–∫ —É–ª—É—á—à–∏—Ç—å —Å–≤–æ–µ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ, –æ—á–µ–Ω—å —ë–º–∫–æ –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω–æ '
                                          '–°–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—à—å —Å–æ —Å–ª–æ–≤: "–ü—Ä–∏–≤–µ—Ç! –Ø –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª –≤—Å–µ —Å–º–∞–π–ª–∏–∫–∏, '
                                          '–∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è–ª –≤ —Ç–µ—á–µ–Ω–∏–∏ —ç—Ç–æ–≥–æ –¥–Ω—è". '
                                          '–û–±—â–∞–π—Å—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∫–∞–∫ —Å –¥—Ä—É–≥–æ–º. –¢–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±—É–∫–≤–∞–ª—å–Ω–æ '
                                          '–Ω–µ –±–æ–ª—å—à–µ 7 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π. –¢–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—á–µ–Ω—å —ë–º–∫–∏–º!'
             },  # –ó–∞–¥–∞–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–º–æ—â–Ω–∏–∫—É
            {"role": "user", "content": f"–î–∞–π –º–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —ç—Ç–∏–º –¥–∞–Ω–Ω—ã–º. \n{smilesDay}"}
            # –ó–∞–¥–∞–µ–º –≤–æ–ø—Ä–æ—Å –±–æ—Ç—É
        ],
        max_tokens=700
    )

    return chat_completion_resp.choices[0].message.content


async def generation_prompt(smiles: str, period: str) -> str:
    """
    –§—É–Ω–∫—Ü–∏—è generation_prompt –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è DALL-E.

    :param smiles: –°–º–∞–π–ª–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    :param period: –ü–µ—Ä–∏–æ–¥ –∑–∞ –∫–æ—Ç–æ—Ä—ã–π –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø–æ—Ä—Ç—Ä–µ—Ç.
    :return: –ü—Ä–æ–º–ø—Ç.
    """

    chat_completion_resp = await openai.ChatCompletion.acreate(
        model="gpt-3.5-turbo",
        messages=[
            {"role": "system", "content": f'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Ç–µ—á–µ–Ω–∏–∏ {"–¥–Ω—è" if period == "day" else "–Ω–µ–¥–µ–ª–∏"} '
                                          f'–æ—Ç–ø—Ä–∞–≤–ª—è–ª —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç—É —Å–º–∞–π–ª–∏–∫–∏, '
                                          '–∫–æ—Ç–æ—Ä—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑–æ–≤–∞–ª–∏ –µ–≥–æ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –º–æ–º–µ–Ω—Ç '
                                          '–æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–º–∞–π–ª–∏–∫–∞. –û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–¥–Ω–∏–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –Ω–∞ –≤—Å–µ —Å–º–∞–π–ª–∏–∫–∏ '
                                          '—Å—Ä–∞–∑—É. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ —Å–º–∞–π–ª–∏–∫–∏ –≤ –æ—Ç–≤–µ—Ç–µ –Ω–µ–ª—å–∑—è. –ë–µ–∑ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤, —ç—Ç–æ –¥–æ–ª–∂–Ω–æ '
                                          '–±—ã—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ–º –æ–¥–Ω–æ–≥–æ –ª–∏—Ü–∞. –í –æ—Ç–≤–µ—Ç–µ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–ø—è—Ç—ã—Ö –∏ –ª—é–±—ã—Ö –¥—Ä—É–≥–∏–∑ '
                                          '–∑–Ω–∞–∫–æ–≤ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–º–∞–π–ª–∏–∫–∏ –∏ –≤—ã–¥–µ–ª–∏ –Ω–∞ –ª–∏—Ü–µ —Ç–æ–ª—å–∫–æ —Ç–µ, '
                                          '–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–æ–±–ª–∞–¥–∞—é—Ç –Ω–∞–¥ –¥—Ä—É–≥–∏–º–∏.'
             },  # –ó–∞–¥–∞–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–º–æ—â–Ω–∏–∫—É
            {"role": "user", "content": f'Make a description of the face using these emoticons:'
                                        f'üò¥, üò™, ü•±, üòç, üò°'},
            # {"role": "assistant", "content": f'The face expresses fatigue, drowsiness, loneliness and irritation, '
            #                                  f'while showing displeasure and attraction to something pleasant.'},
            {"role": "assistant", "content": f'Very tired and sleepy face'},
             {"role": "user", "content": f"Make a description of the face using these emoticons:"
                                        f"\n{smiles}"}
            # –ó–∞–¥–∞–µ–º –≤–æ–ø—Ä–æ—Å –±–æ—Ç—É
        ],
        max_tokens=700

    )
    print(chat_completion_resp.choices[0].message.content)

    return chat_completion_resp.choices[0].message.content